// ==UserScript==
// @name                Disable YouTube AutoPause
// @name:en             Disable YouTube AutoPause
// @namespace           http://tampermonkey.net/
// @version             2025.07.08.001
// @license             MIT License
// @author              CY Fung
// @match               https://www.youtube.com/*
// @exclude             /^https?://\S+\.(txt|png|jpg|jpeg|gif|xml|svg|manifest|log|ini)[^\/]*$/
// @icon                https://raw.githubusercontent.com/cyfung1031/userscript-supports/main/icons/disable-youtube-autopause.svg
// @supportURL          https://github.com/cyfung1031/userscript-supports
// @run-at              document-start
// @grant               none
// @unwrap
// @allFrames           true
// @inject-into         page
// @downloadURL https://raw.githubusercontent.com/gnadgnaoh/Userscripts/release/release/Disable20YouTube20AutoPause.user.js
// @updateURL https://raw.githubusercontent.com/gnadgnaoh/Userscripts/release/release/Disable20YouTube20AutoPause.meta.js
// ==/UserScript==
(function(b){"use strict";const p=(async()=>{})().constructor,g=new WeakMap,P=new WeakMap,_=new WeakMap,f="YouTube";let h=0;const y=e=>e?e.polymerController||e.inst||e||0:e||0,$=e=>y(e).$||e.$||0;function D(...e){Date.now()<h||(h=Date.now()+280,console.log(...e))}function m(e,o,s,n,r,c,a){Object.defineProperty(e,o,{enumerable:!0,configurable:!0,get(){p.resolve(new Date).then(r).catch(console.warn);const t=n;return s===2?`${t}`:t},set(t){const l=a.get(this);return p.resolve([l,t,new Date]).then(c).catch(console.warn),a.set(this,t),!0}})}function w(e,o,s){Object.defineProperty(e,o,{enumerable:!0,configurable:!0,get(){const n=this[s];return(n||0).length>=1&&(n.length=0),n},set(n){return!0}})}function M(e){if(!e||g.has(e))return;const o=e.playbackPauseDelayMs,s=e.promptDelaySec,n=e.lactThresholdMs,r=Math.floor(Number.MAX_SAFE_INTEGER*.1),c=Math.floor(r/1e3);if("playbackPauseDelayMs"in e&&o>=0&&o<4*r){g.set(e,o);const a=typeof o=="string"?2:+(typeof o=="number");a>=1&&m(e,"playbackPauseDelayMs",a,5*r,t=>{D(`${f} is trying to pause video...`,t.toLocaleTimeString())},t=>{const[l,i,u]=t;console.log(`${f} is trying to change value 'playbackPauseDelayMs' from ${l} to ${i} ...`,u.toLocaleTimeString())},g),typeof(e.showPausedActions||0).length=="number"&&!e.tvTyh&&(e.tvTyh=[],w(e,"showPausedActions","tvTyh"))}if("promptDelaySec"in e&&s>=0&&s<4*c){P.set(e,s);const a=typeof s=="string"?2:+(typeof s=="number");a>=1&&m(e,"promptDelaySec",a,5*c,t=>{D(`${f} is trying to pause video...`,t.toLocaleTimeString())},t=>{const[l,i,u]=t;console.log(`${f} is trying to change value 'promptDelaySec' from ${l} to ${i} ...`,u.toLocaleTimeString())},P)}if("lactThresholdMs"in e&&n>=0&&n<4*r){_.set(e,n);const a=typeof n=="string"?2:+(typeof n=="number");a>=1&&m(e,"lactThresholdMs",a,5*r,t=>{},t=>{const[l,i,u]=t;console.log(`${f} is trying to change value 'lactThresholdMs' from ${l} to ${i} ...`,u.toLocaleTimeString())},_)}}let T=!1,v=!1;function S(){const e=new Set,o=document.querySelector("#page-manager")||0;try{const l=(o&&(y(o).data||o.data||y(o).__data||o.__data||0)).playerResponse;l&&e.add(l.messages)}catch{}const s=document.querySelector("#ytd-player")||0,n=s&&(y(s).player_||s.player_||y(s).player||s.player||0);if(n&&typeof n.getPlayerResponse=="function")try{const t=n.getPlayerResponse();t&&e.add(t.messages)}catch{}const r=document.querySelector("#movie_player")||0,c=r&&(y(r).getPlayerResponse?y(r):r);if(c&&typeof c.getPlayerResponse=="function")try{const t=c.getPlayerResponse();t&&e.add(t.messages)}catch{}const a=new Set;for(const t of e)if(t&&t.length>0){for(const l of t)if(l.youThereRenderer){T||(T=!0,console.log("Detected message.youThereRenderer"));let i=null;try{i=l.youThereRenderer.configData.youThereData}catch{}i&&a.add(i),i=null;break}}if(a.size>0){v||(v=!0,console.log("Detected youThereData"));for(const t of a)M(t);a.clear()}}function d(){arguments.length===1&&(h=Date.now()+3400),p.resolve(0).then(()=>{S();const e=document.querySelector("ytd-watch-flexy")||0,o=y(e);if(o){const n=(o.youThereManager_||e.youThereManager_||0||0).youThereData_||0;n&&M(n);const r=o.youthereDataChanged_;typeof r=="function"&&!r.lq2S7&&(console.log("detected ytdFlexyCnt.youthereDataChanged_"),o.youthereDataChanged_=(function(c){return function(){console.log("youthereDataChanged_()");const a=c.apply(this,arguments);return d(),a}})(r),o.youthereDataChanged_.lq2S7=1)}}).catch(console.warn)}document.addEventListener("yt-page-data-updated",d,!1),document.addEventListener("yt-navigate-finish",d,!1),document.addEventListener("spfdone",d,!1)})(Promise);
