// ==UserScript==
// @name                Disable YouTube Music AutoPause
// @name:en             Disable YouTube Music AutoPause
// @namespace           http://tampermonkey.net/
// @version             2025.07.07.002
// @license             MIT License
// @author              CY Fung
// @match               https://music.youtube.com/*
// @exclude             /^https?://\S+\.(txt|png|jpg|jpeg|gif|xml|svg|manifest|log|ini)[^\/]*$/
// @icon                https://raw.githubusercontent.com/cyfung1031/userscript-supports/main/icons/disable-youtube-autopause.svg
// @supportURL          https://github.com/cyfung1031/userscript-supports
// @run-at              document-start
// @grant               none
// @unwrap
// @allFrames           true
// @inject-into         page
// @downloadURL https://raw.githubusercontent.com/gnadgnaoh/Userscripts/release/release/Disable20YouTube20Music20AutoPause.user.js
// @updateURL https://raw.githubusercontent.com/gnadgnaoh/Userscripts/release/release/Disable20YouTube20Music20AutoPause.meta.js
// ==/UserScript==
(function(k){"use strict";const f=(async()=>{})().constructor,g=new WeakMap,v=new WeakMap,M=new WeakMap,y="YouTube Music";let m=0;const c=e=>e?e.polymerController||e.inst||e||0:e||0,H=e=>c(e).$||e.$||0;function T(...e){Date.now()<m||(m=Date.now()+280,console.log(...e))}function h(e,t,s,r,l,i,n){Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get(){f.resolve(new Date).then(l).catch(console.warn);let o=r;return s===2?`${o}`:o},set(o){let a=n.get(this);return f.resolve([a,o,new Date]).then(i).catch(console.warn),n.set(this,o),!0}})}function _(e,t,s){Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get(){const r=this[s];return(r||0).length>=1&&(r.length=0),r},set(r){return!0}})}function L(e){if(!e||g.has(e))return;const t=e.playbackPauseDelayMs,s=e.promptDelaySec,r=e.lactThresholdMs,l=Math.floor(Number.MAX_SAFE_INTEGER*.1),i=Math.floor(l/1e3);if("playbackPauseDelayMs"in e&&t>=0&&t<4*l){g.set(e,t);const n=typeof t=="string"?2:+(typeof t=="number");n>=1&&h(e,"playbackPauseDelayMs",n,5*l,o=>{T(`${y} is trying to pause video...`,o.toLocaleTimeString())},o=>{const[a,p,d]=o;console.log(`${y} is trying to change value 'playbackPauseDelayMs' from ${a} to ${p} ...`,d.toLocaleTimeString())},g),typeof(e.showPausedActions||0).length=="number"&&!e.tvTyh&&(e.tvTyh=[],_(e,"showPausedActions","tvTyh"))}if("promptDelaySec"in e&&s>=0&&s<4*i){v.set(e,s);const n=typeof s=="string"?2:+(typeof s=="number");n>=1&&h(e,"promptDelaySec",n,5*i,o=>{T(`${y} is trying to pause video...`,o.toLocaleTimeString())},o=>{const[a,p,d]=o;console.log(`${y} is trying to change value 'promptDelaySec' from ${a} to ${p} ...`,d.toLocaleTimeString())},v)}if("lactThresholdMs"in e&&r>=0&&r<4*l){M.set(e,r);const n=typeof r=="string"?2:+(typeof r=="number");n>=1&&h(e,"lactThresholdMs",n,5*l,o=>{},o=>{const[a,p,d]=o;console.log(`${y} is trying to change value 'lactThresholdMs' from ${a} to ${p} ...`,d.toLocaleTimeString())},M)}}let P=Symbol(),S=0;function A(e){if(e==1||e==3){const t=S=(S&1073741823)+1;requestAnimationFrame(()=>{t===S&&w()})}}let D=!1,R=!1;function w(){const e=new Set,t=document.querySelector("#player")||0;try{const n=t&&(c(t).__data||t.__data||0),o=n.playerResponse_||n.playerResponse;o&&e.add(o.messages)}catch{}const s=t&&(c(t).playerApi_||t.playerApi_||c(t).playerApi||t.playerApi||0);if(s&&typeof s.getPlayerResponse=="function")try{const n=s.getPlayerResponse();n&&e.add(n.messages)}catch{}const r=document.querySelector("#movie_player")||0,l=r&&(c(r).getPlayerResponse?c(r):r);if(l&&typeof l.getPlayerResponse=="function")try{const n=l.getPlayerResponse();n&&e.add(n.messages)}catch{}const i=new Set;for(const n of e)if(n&&n.length>0){for(const o of n)if(o.youThereRenderer){D||(D=!0,console.log("Detected message.youThereRenderer"));let a=null;try{a=o.youThereRenderer.configData.youThereData}catch{}a&&i.add(a),a=null;break}}if(i.size>0){R||(R=!0,console.log("Detected youThereData"));for(const n of i)L(n);i.clear()}}let u=0;function b(){w();const e=document.querySelector("#player")||0,t=c(e).playerApi_||e.playerApi_||c(e).playerApi||e.playerApi||0;typeof t=="object"&&(typeof t[P]>"u"&&typeof t.getPlayerState=="function"&&(t[P]=t.getPlayerState,t.getPlayerState=function(){let s=this[P](...arguments);if(s==1||s==3)try{w()}catch{}return s}),"removeEventListener"in t&&"addEventListener"in t&&(t.removeEventListener("onStateChange",A,!1),t.addEventListener("onStateChange",A,!1)))}async function $(){m=Date.now()+3400;const e=u=(u&1073741823)+1;await f.resolve(0),e===u&&(b(),await new f(t=>setTimeout(t,3200)),e===u&&(b(),await new f(t=>setTimeout(t,5400)),e===u&&b()))}function E(e){e.target.nodeName=="VIDEO"&&e.target.closest("#player")&&$()}document.addEventListener("canplay",E,!0)})(Promise);
